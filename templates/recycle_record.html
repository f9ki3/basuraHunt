<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BasuraHunt</title>
    {% include 'header_links.html' %}
</head>
<body>
    {% include 'nav-admin.html' %}
    <div class="container d-flex flex-row">
        {% include 'header.html' %}
        <div class="container body-color">
            <div id="viewRecycleRecord"></div>
            <div class="row" id="viewRecycleRecordsTable">
                <h4>Recycle Records</h4>
                <div class="col-12 col-md-6">
                    <input class="w-100 form-control form-control-sm no-outline" placeholder="Search here ..." type="text" id="recycleSearchInput">
                </div>
                <div class="col-12 col-md-6 d-flex flex-row">
                    <button class="btn btn-sm" id="filterAll">All</button>
                    <button class="btn btn-sm" id="filterPlastic">Plastic</button>
                    <button class="btn btn-sm" id="filterPaper">Paper</button>
                    <button class="btn btn-sm" id="filterMetal">Metal</button>
                    <select class="form-select form-select-sm no-outline border-none" id="recycleItemsPerPage">
                        <option value="10" selected>Show 10 Items</option>
                        <option value="15">Show 15 Items</option>
                        <option value="20">Show 20 Items</option>
                        <option value="100">Show 100 Items</option>
                    </select>
                </div>
                <div class="col-12">
                    <table class="table table-hover text-muted mt-3 mb-4" style="font-size: 12px;">
                        <thead>
                          <tr>
                            <th scope="col" width="5%">Account ID</th>
                            <th scope="col" width="25%">Recycle ID</th>
                            <th scope="col" width="25%">Recycle Type</th>
                            <th scope="col" width="25%">Grade Level and Section</th>
                            <th scope="col" width="25%"></th>
                          </tr>
                        </thead>
                        <tbody id="recycleRecycle"></tbody>
                    </table>
                    <p id="noRecycleItemsMessage" class="text-muted" style="display: none;">No items found.</p>
                </div>
                <div class="col-12">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination pagination-sm" id="recyclePaginationControls">
                            <!-- Pagination controls will be dynamically added here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    {% include 'footer_links.html' %}
</body>
</html>
<script>
    let dataCache = []; // To store fetched data for filtering
    let imagesArrayRecycle = []; // Global array to store image paths

    // Fetch and display recycle records
    function recycleRecycle() {
        $.ajax({
            type: "GET",
            url: "/get_all_recycle_points",
            dataType: "json",
            success: function (data) {
                dataCache = data; // Cache the fetched data
                renderTable(data); // Render the table with the fetched data
            },
            error: function (xhr, status, error) {
                console.error('Error fetching reports:', error);
            }
        });
    }

    // Render table with data
    function renderTable(data) {
        $('#recycleRecycle').empty(); // Clear existing table rows

        if (data.length === 0) {
            $('#noRecycleItemsMessage').show();
            return;
        }
        $('#noRecycleItemsMessage').hide();

        data.forEach(item => {
            const row = `
                <tr>
                    <td class="pt-3 pb-3">${item.id}</td>
                    <td class="pt-3 pb-3">${item.recycle_id}</td>
                    <td class="pt-3 pb-3">${item.recycle_type}</td>
                    <td class="pt-3 pb-3">${item.grade_level} ${item.section}</td>
                    <td class="pt-3 pb-3"><button class="btn btn-sm">Receive</button></td>
                </tr>
            `;
            $('#recycleRecycle').append(row);
        });
    }

    // Search functionality
    $('#recycleSearchInput').on('input', function () {
        const query = $(this).val().toLowerCase();
        const filteredData = dataCache.filter(item =>
            item.recycle_id.toLowerCase().includes(query) ||
            item.recycle_type.toLowerCase().includes(query) ||
            (item.grade_level + " " + item.section).toLowerCase().includes(query)
        );
        renderTable(filteredData); // Display filtered results
    });

    recycleRecycle(); // Fetch data on page load
</script>
